<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <title>Memory Match Game</title>
</head>
<body>
    <a-scene background="color: #87CEEB">
        <!-- Camera with cursor for clicking -->
        <a-camera position="0 1.6 3">
            <a-cursor 
                position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                material="color: white; shader: flat"
                animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 1 1 1"
                animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 1 1 1; to: 0.1 0.1 0.1"
                animation__mouseleave="property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 500; to: 1 1 1">
            </a-cursor>
        </a-camera>
        
        <!-- Win Message (hidden initially) -->
        <a-text 
            id="win-message"
            value="YOU WON!\nAll pairs matched!"
            position="0 2.8 0"
            align="center"
            color="gold"
            scale="0 0 0"
            font="kelsonsans"
            animation__appear="property: scale; startEvents: showWin; dur: 1000; easing: easeOutBounce; to: 2 2 2"
            animation__glow="property: material.color; startEvents: showWin; dur: 2000; easing: easeInOutSine; loop: true; dir: alternate; from: gold; to: yellow">
        </a-text>
        
        <!-- Game Cards -->
        <a-entity id="game-board" position="0 1.6 0">
            <!-- Row 1 -->
            <a-box class="card" position="-1.5 0.5 0" width="0.8" height="0.8" depth="0.1" 
                   color="blue" data-card-id="0" data-symbol="A" data-original-z="0"></a-box>
            <a-box class="card" position="-0.5 0.5 0" width="0.8" height="0.8" depth="0.1" 
                   color="blue" data-card-id="1" data-symbol="B" data-original-z="0"></a-box>
            <a-box class="card" position="0.5 0.5 0" width="0.8" height="0.8" depth="0.1" 
                   color="blue" data-card-id="2" data-symbol="C" data-original-z="0"></a-box>
            <a-box class="card" position="1.5 0.5 0" width="0.8" height="0.8" depth="0.1" 
                   color="blue" data-card-id="3" data-symbol="A" data-original-z="0"></a-box>
            
            <!-- Row 2 -->
            <a-box class="card" position="-1.5 -0.5 0" width="0.8" height="0.8" depth="0.1" 
                   color="blue" data-card-id="4" data-symbol="D" data-original-z="0"></a-box>
            <a-box class="card" position="-0.5 -0.5 0" width="0.8" height="0.8" depth="0.1" 
                   color="blue" data-card-id="5" data-symbol="E" data-original-z="0"></a-box>
            <a-box class="card" position="0.5 -0.5 0" width="0.8" height="0.8" depth="0.1" 
                   color="blue" data-card-id="6" data-symbol="F" data-original-z="0"></a-box>
            <a-box class="card" position="1.5 -0.5 0" width="0.8" height="0.8" depth="0.1" 
                   color="blue" data-card-id="7" data-symbol="B" data-original-z="0"></a-box>
            
            <!-- Row 3 -->
            <a-box class="card" position="-1.5 -1.5 0" width="0.8" height="0.8" depth="0.1" 
                   color="blue" data-card-id="8" data-symbol="C" data-original-z="0"></a-box>
            <a-box class="card" position="-0.5 -1.5 0" width="0.8" height="0.8" depth="0.1" 
                   color="blue" data-card-id="9" data-symbol="D" data-original-z="0"></a-box>
            <a-box class="card" position="0.5 -1.5 0" width="0.8" height="0.8" depth="0.1" 
                   color="blue" data-card-id="10" data-symbol="E" data-original-z="0"></a-box>
            <a-box class="card" position="1.5 -1.5 0" width="0.8" height="0.8" depth="0.1" 
                   color="blue" data-card-id="11" data-symbol="F" data-original-z="0"></a-box>
        </a-entity>
    </a-scene>

    <script>
        // Game state variables
        let flippedCards = [];
        let matchedPairs = 0;
        let canClick = true;
        let flipCounter = 0; // Track order of flips to prevent z-fighting

        // Add click listeners to all cards
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.addEventListener('click', handleCardClick);
            });
        });

        function handleCardClick(event) {
            if (!canClick) return;
            
            const card = event.target;
            const cardId = card.getAttribute('data-card-id');
            const symbol = card.getAttribute('data-symbol');
            
            // Don't flip if already flipped or matched
            if (card.getAttribute('data-flipped') === 'true' || 
                card.getAttribute('data-matched') === 'true') {
                return;
            }
            
            // Flip the card (change color to show symbol)
            flipCard(card, symbol);
            flippedCards.push({card, symbol, cardId});
            
            // Check for matches when 2 cards are flipped
            if (flippedCards.length === 2) {
                canClick = false;
                setTimeout(checkMatch, 1000);
            }
        }

        function flipCard(card, symbol) {
            // Change color based on symbol (simple visual representation)
            const colors = {
                'A': 'red', 'B': 'green', 'C': 'yellow', 
                'D': 'orange', 'E': 'purple', 'F': 'pink'
            };
            
            // Get current position and move card forward with unique spacing
            const currentPosition = card.getAttribute('position');
            flipCounter++; // Increment counter for each flip
            const uniqueZOffset = 0.05 + (flipCounter * 0.01); // Each card gets slightly different Z
            const newPosition = `${currentPosition.x} ${currentPosition.y} ${currentPosition.z + uniqueZOffset}`;
            
            card.setAttribute('color', colors[symbol]);
            card.setAttribute('position', newPosition);
            card.setAttribute('data-flipped', 'true');
            card.setAttribute('data-flip-order', flipCounter); // Store flip order
        }

        function checkMatch() {
            const [card1, card2] = flippedCards;
            
            if (card1.symbol === card2.symbol) {
                // Match found - make cards disappear
                card1.card.setAttribute('visible', 'false');
                card2.card.setAttribute('data-matched', 'true');
                card1.card.setAttribute('data-matched', 'true');
                card2.card.setAttribute('visible', 'false');
                
                matchedPairs++;
                
                // Check win condition
                if (matchedPairs === 6) {
                    showWinMessage();
                }
            } else {
                // No match - flip cards back and return to original position
                const originalZ1 = parseFloat(card1.card.getAttribute('data-original-z'));
                const originalZ2 = parseFloat(card2.card.getAttribute('data-original-z'));
                
                const pos1 = card1.card.getAttribute('position');
                const pos2 = card2.card.getAttribute('position');
                
                card1.card.setAttribute('color', 'blue');
                card1.card.setAttribute('position', `${pos1.x} ${pos1.y} ${originalZ1}`);
                card1.card.setAttribute('data-flipped', 'false');
                card1.card.removeAttribute('data-flip-order');
                
                card2.card.setAttribute('color', 'blue');
                card2.card.setAttribute('position', `${pos2.x} ${pos2.y} ${originalZ2}`);
                card2.card.setAttribute('data-flipped', 'false');
                card2.card.removeAttribute('data-flip-order');
            }
            
            // Reset for next turn
            flippedCards = [];
            canClick = true;
        }

        function showWinMessage() {
            const winMessage = document.getElementById('win-message');
            winMessage.emit('showWin');
        }
    </script>
</body>
</html>
